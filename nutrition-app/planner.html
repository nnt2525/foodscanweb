<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - NutriTrack</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <main class="main-content">
            <div class="container fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-3xl font-bold">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
                    <span class="text-gray" id="todayDate"></span>
                </div>

                <!-- Daily Summary -->
                <div class="card mb-6" style="background: var(--gradient-primary); color: white;">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm" style="opacity: 0.9;">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                            <div class="text-3xl font-bold" id="totalCalories">0</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm" style="opacity: 0.9;">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
                            <div class="text-xl font-bold">2,000 kcal</div>
                        </div>
                    </div>
                    <div class="progress-bar mt-4" style="background: rgba(255,255,255,0.3);">
                        <div id="caloriesProgress"
                            style="height:100%;background:white;border-radius:9999px;transition:width 0.3s;"></div>
                    </div>
                </div>

                <!-- Meals -->
                <div class="grid grid-cols-2 grid-responsive gap-6">
                    <div class="card" id="mealBreakfast">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold flex items-center gap-2">üåÖ ‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</h2>
                            <a href="search.html" class="btn btn-sm btn-ghost">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</a>
                        </div>
                        <div id="breakfastList" class="space-y-2"></div>
                    </div>

                    <div class="card" id="mealLunch">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold flex items-center gap-2">‚òÄÔ∏è ‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</h2>
                            <a href="search.html" class="btn btn-sm btn-ghost">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</a>
                        </div>
                        <div id="lunchList" class="space-y-2"></div>
                    </div>

                    <div class="card" id="mealDinner">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold flex items-center gap-2">üåô ‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô</h2>
                            <a href="search.html" class="btn btn-sm btn-ghost">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</a>
                        </div>
                        <div id="dinnerList" class="space-y-2"></div>
                    </div>

                    <div class="card" id="mealSnacks">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold flex items-center gap-2">üçø ‡∏Ç‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</h2>
                            <a href="search.html" class="btn btn-sm btn-ghost">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</a>
                        </div>
                        <div id="snacksList" class="space-y-2"></div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card mt-6">
                    <div class="flex gap-4 justify-center">
                        <button onclick="clearAllMeals()" class="btn btn-secondary">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <a href="search.html" class="btn btn-primary">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        if (!requireAuth()) throw new Error('Not authorized');

        document.getElementById('todayDate').textContent = formatDate(new Date());

        function renderMeals() {
            const meals = getFromLocalStorage('nutritrack_meals', { breakfast: [], lunch: [], dinner: [], snacks: [] });
            let total = 0;

            ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(type => {
                const list = document.getElementById(type + 'List');
                const items = meals[type] || [];

                if (items.length === 0) {
                    list.innerHTML = '<p class="text-gray text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                } else {
                    list.innerHTML = items.map((item, i) => {
                        total += item.calories;
                        return `
                            <div class="flex items-center justify-between" style="padding:0.5rem;background:var(--gray-50);border-radius:0.5rem;">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">${item.name}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm text-primary">${item.calories} kcal</span>
                                    <button onclick="removeMeal('${type}', ${i})" class="text-gray" style="cursor:pointer;">‚úï</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            });

            document.getElementById('totalCalories').textContent = formatNumber(total);
            document.getElementById('caloriesProgress').style.width = Math.min((total / 2000) * 100, 100) + '%';
        }

        function removeMeal(type, index) {
            const meals = getFromLocalStorage('nutritrack_meals', {});
            meals[type].splice(index, 1);
            saveToLocalStorage('nutritrack_meals', meals);
            renderMeals();
            showNotification('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        function clearAllMeals() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
                saveToLocalStorage('nutritrack_meals', { breakfast: [], lunch: [], dinner: [], snacks: [] });
                renderMeals();
                showNotification('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        renderMeals();
    </script>
    <style>
        .space-y-2>*+* {
            margin-top: 0.5rem;
        }
    </style>
</body>

</html>