<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - NutriTrack</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <main class="main-content">
            <div class="container fade-in" style="max-width: 600px;">
                <h1 class="text-3xl font-bold text-center mb-6">‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>

                <div class="card text-center">
                    <!-- Scanner Area -->
                    <div id="scannerArea"
                        style="position:relative;height:280px;background:var(--gray-100);border-radius:1rem;overflow:hidden;margin-bottom:1.5rem;">
                        <div id="placeholder" class="flex flex-col items-center justify-center" style="height:100%;">
                            <div class="text-6xl mb-4">üì∏</div>
                            <p class="text-gray">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</p>
                        </div>
                        <div id="scanning" class="hidden" style="height:100%;position:relative;">
                            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
                                <div class="loading-spinner" style="margin:0 auto 1rem;"></div>
                                <p class="text-primary font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
                            </div>
                            <div class="scanner-line" style="position:absolute;top:0;left:0;"></div>
                        </div>
                    </div>

                    <button id="scanBtn" onclick="startScan()" class="btn btn-primary btn-lg btn-block">
                        üì∑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô
                    </button>

                    <!-- Result -->
                    <div id="result" class="hidden mt-6 text-left"></div>
                </div>

                <div class="card mt-6" style="background:var(--primary-50);">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üí°</span>
                        <div>
                            <p class="font-semibold mb-1">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö</p>
                            <p class="text-sm text-gray">‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏™‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
                        </div>
                    </div>
                </div>

                <div class="card mt-4" style="background:#fff3cd;border:1px solid #ffc107;">
                    <p class="text-sm" style="color:#856404;">
                        <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á (Demo)
                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/data.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        if (!requireAuth()) throw new Error('Not authorized');

        function startScan() {
            const placeholder = document.getElementById('placeholder');
            const scanning = document.getElementById('scanning');
            const result = document.getElementById('result');
            const scanBtn = document.getElementById('scanBtn');

            placeholder.classList.add('hidden');
            scanning.classList.remove('hidden');
            result.classList.add('hidden');
            scanBtn.disabled = true;
            scanBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...';

            // Simulate scanning delay
            // Simulate scanning delay
            setTimeout(() => {
                // Random food ID (1-8 based on mockFoods)
                const randomId = Math.floor(Math.random() * 8) + 1;
                window.location.href = `scan-result.html?id=${randomId}`;
            }, 2000);
        }

        function addScannedFood(id) {
            const food = mockFoods.find(f => f.id === id);
            const meals = getFromLocalStorage('nutritrack_meals', { breakfast: [], lunch: [], dinner: [], snacks: [] });
            const now = new Date().getHours();
            let mealType = now < 10 ? 'breakfast' : now < 14 ? 'lunch' : now < 20 ? 'dinner' : 'snacks';

            meals[mealType].push({ ...food, addedAt: new Date().toISOString() });
            saveToLocalStorage('nutritrack_meals', meals);
            showNotification(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${food.name} ‡∏•‡∏á‡πÉ‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
        }
    </script>
</body>

</html>