<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå - NutriTrack</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <main class="main-content">
            <div class="container fade-in" style="max-width: 600px;">
                <h1 class="text-3xl font-bold mb-6">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h1>

                <!-- Profile Card -->
                <div class="card text-center mb-6">
                    <div class="text-6xl mb-4">üë§</div>
                    <h2 class="text-2xl font-bold" id="userName"></h2>
                    <p class="text-gray" id="userEmail"></p>
                    <p class="text-sm text-gray mt-2">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà: <span id="joinDate"></span></p>
                </div>

                <!-- Profile Form -->
                <div class="card mb-6">
                    <h2 class="text-xl font-bold mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
                    <form id="profileForm" onsubmit="saveProfile(event)">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                                <input type="number" id="weight" class="form-input" placeholder="60">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
                                <input type="number" id="height" class="form-input" placeholder="170">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡∏≠‡∏≤‡∏¢‡∏∏</label>
                                <input type="number" id="age" class="form-input" placeholder="25">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡πÄ‡∏û‡∏®</label>
                                <select id="gender" class="form-input">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                    <option value="male">‡∏ä‡∏≤‡∏¢</option>
                                    <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <select id="activity" class="form-input">
                                <option value="sedentary">‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡πà‡∏á‡πÇ‡∏ï‡πä‡∏∞)</option>
                                <option value="light">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏ö‡∏≤‡πÜ (1-3 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                                <option value="moderate">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3-5 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                                <option value="active">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å (6-7 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                                <option value="very_active">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å (‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                            <select id="goal" class="form-input">
                                <option value="lose">‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</option>
                                <option value="maintain">‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</option>
                                <option value="gain">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </form>

                    <!-- Results Grid -->
                    <div class="grid grid-cols-1 gap-4" id="resultsSection" style="display:none;">
                        <!-- BMI Result -->
                        <div class="stat-card text-center fade-in bg-gray-50 border border-gray-200">
                            <div class="stat-card-icon mb-2">‚öñÔ∏è</div>
                            <div class="stat-card-label mb-1">BMI ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
                            <div class="stat-card-value mb-2" id="bmiValue">--</div>
                            <div id="bmiStatus" class="badge">--</div>
                        </div>

                        <!-- Calorie Result -->
                        <div class="stat-card text-center fade-in bg-gray-50 border border-gray-200"
                            style="border-left-color: #f97316;">
                            <div class="stat-card-icon mb-2">üî•</div>
                            <div class="stat-card-label mb-1">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div>
                            <div class="stat-card-value text-primary mb-1" id="calorieValue" style="color: #f97316;">--
                            </div>
                            <div class="text-xs text-gray">‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</div>
                        </div>
                    </div>
                </div>

                <!-- Logout -->
                <button onclick="logout()" class="btn btn-secondary btn-block">
                    üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </main>
    </div>

    <script src="../js/data.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        if (!requireAuth()) throw new Error('Not authorized');

        const user = getCurrentUser();
        document.getElementById('userName').textContent = user.name;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('joinDate').textContent = new Date(user.createdAt).toLocaleDateString('th-TH');

        // Load existing profile
        if (user.profile) {
            document.getElementById('weight').value = user.profile.weight || '';
            document.getElementById('height').value = user.profile.height || '';
            document.getElementById('age').value = user.profile.age || '';
            document.getElementById('gender').value = user.profile.gender || '';
            document.getElementById('activity').value = user.profile.activity || 'sedentary';
            document.getElementById('goal').value = user.profile.goal || 'maintain';
            updateStats();
        }

        function saveProfile(e) {
            e.preventDefault();
            const data = {
                weight: parseFloat(document.getElementById('weight').value),
                height: parseFloat(document.getElementById('height').value),
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value
            };

            updateProfile(data);
            updateStats();
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        function updateStats() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activity = document.getElementById('activity').value;
            const goal = document.getElementById('goal').value;

            if (weight && height && age && gender) {
                // BMI
                const bmi = calculateBMI(weight, height);
                const bmiStatus = getBMIStatus(bmi);

                document.getElementById('resultsSection').style.display = 'grid';
                document.getElementById('bmiValue').textContent = bmi;
                document.getElementById('bmiStatus').textContent = bmiStatus.label;
                document.getElementById('bmiStatus').style.background = bmiStatus.color;
                document.getElementById('bmiStatus').style.color = 'white';

                // Calories
                const bmr = calculateBMR(weight, height, age, gender);
                const tdee = calculateTDEE(bmr, activity);
                const recommended = calculateRecommendedCalories(tdee, goal);

                document.getElementById('calorieValue').textContent = formatNumber(recommended);
            }
        }
    </script>
</body>

</html>