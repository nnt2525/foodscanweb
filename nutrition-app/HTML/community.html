<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ä‡∏∏‡∏°‡∏ä‡∏ô - NutriTrack</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <main class="main-content">
            <div class="container fade-in" style="max-width: 700px;">
                <h1 class="text-3xl font-bold mb-6">‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</h1>

                <!-- New Post -->
                <div class="card mb-6" id="newPostCard" style="display:none;">
                    <h2 class="font-bold mb-4">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                    <textarea id="postContent" class="form-input" rows="3"
                        placeholder="‡πÅ‡∏ä‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö..."></textarea>
                    <div class="flex justify-end gap-2 mt-4">
                        <button onclick="cancelPost()" class="btn btn-secondary btn-sm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button onclick="submitPost()" class="btn btn-primary btn-sm">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
                    </div>
                </div>

                <button id="showPostBtn" onclick="showNewPost()" class="btn btn-primary mb-6 btn-block">
                    ‚úèÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà
                </button>

                <!-- Posts -->
                <div id="postsList"></div>
            </div>
        </main>
    </div>

    <script src="../js/data.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        let posts = getFromLocalStorage('nutritrack_posts', [...mockPosts]);

        function renderPosts() {
            document.getElementById('postsList').innerHTML = posts.map(p => `
                <div class="card mb-4">
                    <div class="flex items-start gap-3">
                        <div class="text-3xl">${p.avatar}</div>
                        <div class="flex-1">
                            <h3 class="font-bold">${p.author}</h3>
                            <p class="text-sm text-gray mb-3">${p.timestamp}</p>
                            <p class="mb-4">${p.content}</p>
                            <div class="flex gap-6">
                                <button onclick="toggleLike(${p.id})" class="flex items-center gap-1 ${p.liked ? 'text-primary' : 'text-gray'}" style="cursor:pointer;background:none;border:none;">
                                    ${p.liked ? '‚ù§Ô∏è' : 'ü§ç'} ${p.likes}
                                </button>
                                <span class="flex items-center gap-1 text-gray">üí¨ ${p.comments}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleLike(id) {
            const post = posts.find(p => p.id === id);
            if (post) {
                post.liked = !post.liked;
                post.likes += post.liked ? 1 : -1;
                saveToLocalStorage('nutritrack_posts', posts);
                renderPosts();
            }
        }

        function showNewPost() {
            if (!isLoggedIn()) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                setTimeout(() => window.location.href = 'login.html', 1000);
                return;
            }
            document.getElementById('newPostCard').style.display = 'block';
            document.getElementById('showPostBtn').style.display = 'none';
        }

        function cancelPost() {
            document.getElementById('newPostCard').style.display = 'none';
            document.getElementById('showPostBtn').style.display = 'block';
            document.getElementById('postContent').value = '';
        }

        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) return showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'warning');

            const user = getCurrentUser();
            posts.unshift({
                id: Date.now(),
                author: user.name,
                avatar: 'üë§',
                content,
                likes: 0,
                comments: 0,
                timestamp: '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                liked: false
            });

            saveToLocalStorage('nutritrack_posts', posts);
            cancelPost();
            renderPosts();
            showNotification('‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        renderPosts();
    </script>
</body>

</html>