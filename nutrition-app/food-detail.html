<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดอาหาร - NutriTrack</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <main class="main-content">
            <div class="container fade-in" id="foodContent">
                <div class="text-center" style="padding: 3rem;">
                    <div class="loading-spinner" style="margin: 0 auto;"></div>
                    <p class="text-gray mt-4">กำลังโหลด...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        const foodId = parseInt(getQueryParam('id'));
        const food = mockFoods.find(f => f.id === foodId);
        const container = document.getElementById('foodContent');

        if (!food) {
            container.innerHTML = `
                <div class="text-center" style="padding: 3rem;">
                    <div class="text-4xl mb-4">❌</div>
                    <h2 class="text-2xl font-bold mb-2">ไม่พบอาหาร</h2>
                    <p class="text-gray mb-4">อาหารที่คุณค้นหาไม่มีในระบบ</p>
                    <a href="search.html" class="btn btn-primary">กลับไปค้นหา</a>
                </div>
            `;
        } else {
            document.title = `${food.name} - NutriTrack`;
            const n = food.nutrition;

            container.innerHTML = `
                <a href="search.html" class="btn btn-ghost mb-4">← กลับ</a>
                
                <div class="grid grid-cols-2 grid-responsive gap-6">
                    <div>
                        <img src="${food.image}" alt="${food.name}" style="width:100%;height:300px;object-fit:cover;border-radius:1rem;">
                        <div class="flex gap-2 mt-4 flex-wrap">
                            ${food.tags.map(t => `<span class="badge badge-green">${t}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h1 class="text-3xl font-bold mb-2">${food.name}</h1>
                        <p class="text-gray mb-4">${food.nameEn} • ${food.category}</p>
                        <p class="mb-4">${food.description}</p>
                        
                        <div class="card mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-bold">ปริมาณต่อหนึ่งที่</span>
                                <span class="badge badge-blue">${food.servingSize}g</span>
                            </div>
                            <div class="text-center mb-4" style="padding:1rem;background:var(--primary-50);border-radius:0.75rem;">
                                <div class="text-3xl font-bold text-primary">${food.calories}</div>
                                <div class="text-gray">แคลอรี่</div>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div style="padding:1rem;background:var(--gray-50);border-radius:0.5rem;">
                                    <div class="font-bold">${n.carbohydrates.total}g</div>
                                    <div class="text-sm text-gray">คาร์บ</div>
                                </div>
                                <div style="padding:1rem;background:var(--gray-50);border-radius:0.5rem;">
                                    <div class="font-bold">${n.protein.total}g</div>
                                    <div class="text-sm text-gray">โปรตีน</div>
                                </div>
                                <div style="padding:1rem;background:var(--gray-50);border-radius:0.5rem;">
                                    <div class="font-bold">${n.fat.total}g</div>
                                    <div class="text-sm text-gray">ไขมัน</div>
                                </div>
                            </div>
                        </div>
                        
                        ${isLoggedIn() ? `
                            <div class="form-group mb-4">
                                <label class="form-label">เลือกมื้ออาหาร</label>
                                <select id="mealSelect" class="form-input">
                                    <option value="breakfast">มื้อเช้า</option>
                                    <option value="lunch">มื้อเที่ยง</option>
                                    <option value="dinner">มื้อเย็น</option>
                                    <option value="snacks">ของว่าง</option>
                                </select>
                            </div>
                            <button onclick="addToMeal()" class="btn btn-primary btn-block btn-lg">
                                + เพิ่มลงมื้ออาหาร
                            </button>
                        ` : `
                            <a href="login.html" class="btn btn-primary btn-block btn-lg">
                                เข้าสู่ระบบเพื่อบันทึก
                            </a>
                        `}
                    </div>
                </div>
                
                <!-- Detailed Nutrition -->
                <div class="card mt-6">
                    <h2 class="text-xl font-bold mb-4">ข้อมูลโภชนาการโดยละเอียด</h2>
                    <div class="grid grid-cols-2 grid-responsive gap-6">
                        <div>
                            <h3 class="font-semibold mb-3">คาร์โบไฮเดรต</h3>
                            <div class="text-sm">
                                <div class="flex justify-between mb-2"><span>รวม</span><span>${n.carbohydrates.total}g</span></div>
                                <div class="flex justify-between mb-2 text-gray"><span>ใยอาหาร</span><span>${n.carbohydrates.fiber}g</span></div>
                                <div class="flex justify-between text-gray"><span>น้ำตาล</span><span>${n.carbohydrates.sugar}g</span></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-3">ไขมัน</h3>
                            <div class="text-sm">
                                <div class="flex justify-between mb-2"><span>รวม</span><span>${n.fat.total}g</span></div>
                                <div class="flex justify-between mb-2 text-gray"><span>อิ่มตัว</span><span>${n.fat.saturated}g</span></div>
                                <div class="flex justify-between text-gray"><span>ไม่อิ่มตัว</span><span>${n.fat.unsaturated}g</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Benefits -->
                <div class="card mt-6">
                    <h2 class="text-xl font-bold mb-4">ประโยชน์</h2>
                    <div class="flex gap-2 flex-wrap">
                        ${food.benefits.map(b => `
                            <span class="badge badge-blue" style="padding: 0.5rem 1rem; font-size: 0.875rem;">✓ ${b}</span>
                        `).join('')}
                    </div>
                </div>
            `;

            // Set default meal based on time
            if (isLoggedIn()) {
                const now = new Date().getHours();
                let defaultMeal = 'snacks';
                if (now < 10) defaultMeal = 'breakfast';
                else if (now < 14) defaultMeal = 'lunch';
                else if (now < 20) defaultMeal = 'dinner';

                // Use setTimeout to ensure DOM is ready
                setTimeout(() => {
                    const select = document.getElementById('mealSelect');
                    if (select) select.value = defaultMeal;
                }, 0);
            }
        }

        function addToMeal() {
            const meals = getFromLocalStorage('nutritrack_meals', { breakfast: [], lunch: [], dinner: [], snacks: [] });
            const mealType = document.getElementById('mealSelect').value;
            const mealNames = {
                breakfast: 'มื้อเช้า',
                lunch: 'มื้อเที่ยง',
                dinner: 'มื้อเย็น',
                snacks: 'ของว่าง'
            };

            meals[mealType].push({ ...food, addedAt: new Date().toISOString() });
            saveToLocalStorage('nutritrack_meals', meals);
            showNotification(`เพิ่ม ${food.name} ลงใน${mealNames[mealType]}แล้ว!`, 'success');
        }
    </script>
</body>

</html>